<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏á‡∏≤‡∏ô‡πÅ‡∏°‡πà‡∏ö‡πâ‡∏≤‡∏ô</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
@import url('https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;600;700&display=swap');
body { font-family: 'Sarabun', sans-serif; }
.fade-in { animation: fadeIn 0.3s ease-in; }
@keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
.image-preview { transition: all 0.3s ease; }
.image-preview:hover { transform: scale(1.05); }
</style>
</head>
<body class="bg-gradient-to-br from-blue-50 to-indigo-100 min-h-screen">

<div class="bg-white shadow-lg border-b-4 border-blue-500">
    <div class="container mx-auto px-4 py-6">
        <h1 class="text-3xl font-bold text-gray-800 text-center">üè† ‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°‡∏á‡∏≤‡∏ô‡πÅ‡∏°‡πà‡∏ö‡πâ‡∏≤‡∏ô</h1>
        <div class="flex justify-center mt-4 space-x-4">
            <button onclick="showTab('tasks')" id="tasksTab" class="px-6 py-2 bg-blue-500 text-white rounded-lg font-medium hover:bg-blue-600 transition-colors">
                üìã ‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
            </button>
            <button onclick="showTab('summary')" id="summaryTab" class="px-6 py-2 bg-gray-200 text-gray-700 rounded-lg font-medium hover:bg-gray-300 transition-colors">
                üìä ‡∏™‡∏£‡∏∏‡∏õ‡∏á‡∏≤‡∏ô
            </button>
        </div>
    </div>
</div>

<div class="container mx-auto px-4 py-4">
    <div class="bg-white rounded-lg shadow-md p-4">
        <div class="flex justify-between items-center mb-2">
            <span class="text-sm font-medium text-gray-700">‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ô‡∏µ‡πâ</span>
            <span id="progressText" class="text-sm font-bold text-blue-600">0%</span>
        </div>
        <div class="w-full bg-gray-200 rounded-full h-3">
            <div id="progressBar" class="bg-gradient-to-r from-blue-500 to-green-500 h-3 rounded-full transition-all duration-500" style="width: 0%"></div>
        </div>
    </div>
</div>

<div id="tasksContent" class="container mx-auto px-4 pb-8">
    <div class="bg-white rounded-lg shadow-md p-4 mb-6">
        <h3 class="text-lg font-semibold mb-4 text-gray-800">üîç ‡∏ï‡∏±‡∏ß‡∏Å‡∏£‡∏≠‡∏á</h3>
        <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
            <select id="floorFilter" class="border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                <option value="">‡∏ó‡∏∏‡∏Å‡∏ä‡∏±‡πâ‡∏ô</option>
            </select>
            <select id="roomFilter" class="border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                <option value="">‡∏ó‡∏∏‡∏Å‡∏´‡πâ‡∏≠‡∏á</option>
            </select>
            <select id="statusFilter" class="border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                <option value="">‡∏ó‡∏∏‡∏Å‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</option>
                <option value="completed">‡πÄ‡∏™‡∏£‡πá‡∏à‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢</option>
                <option value="pending">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏™‡∏£‡πá‡∏à</option>
            </select>
            <button onclick="resetAllTasks()" class="bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 transition-colors font-medium">
                üîÑ ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏ó‡∏∏‡∏Å‡∏á‡∏≤‡∏ô
            </button>
        </div>
    </div>

    <div id="tasksGrid" class="grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6"></div>
</div>

<div id="summaryContent" class="container mx-auto px-4 pb-8 hidden">
    <div class="bg-white rounded-lg shadow-md p-6">
        <h3 class="text-2xl font-bold mb-6 text-gray-800">üìä ‡∏™‡∏£‡∏∏‡∏õ‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</h3>
        <div id="summaryStats" class="grid grid-cols-1 md:grid-cols-5 gap-4 mb-6"></div>
        <div id="summaryTable" class="overflow-x-auto"></div>
    </div>
</div>

<div id="imageModal" class="fixed inset-0 bg-black bg-opacity-75 hidden z-50 flex items-center justify-center p-4">
    <div class="bg-white rounded-lg max-w-full max-h-full overflow-auto">
        <div class="p-4 border-b flex justify-between items-center">
            <h3 class="text-lg font-semibold">‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û‡∏á‡∏≤‡∏ô</h3>
            <button onclick="closeImageModal()" class="text-gray-500 hover:text-gray-700 text-2xl">&times;</button>
        </div>
        <div id="imageModalContent" class="p-4 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"></div>
    </div>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/12.2.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/12.2.0/firebase-database-compat.js"></script>

<script>
  // ====== Global Variables ======
  const floors = {
    3: Array.from({length: 10}, (_, i) => 301 + i),
    4: Array.from({length: 10}, (_, i) => 401 + i),
    5: Array.from({length: 8}, (_, i) => 501 + i),
    6: Array.from({length: 8}, (_, i) => 601 + i)
  };
  const taskTypes = ['‡∏£‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏á‡∏´‡πâ‡∏≠‡∏á','‡∏Å‡∏£‡∏∞‡∏à‡∏Å‡∏´‡πâ‡∏≠‡∏á‡∏û‡∏±‡∏Å','‡∏ã‡∏±‡∏Å‡∏û‡∏£‡∏°','‡∏Ç‡∏±‡∏î‡πÄ‡∏Ñ‡πâ‡∏≤‡πÄ‡∏ï‡∏≠‡∏£‡πå‡∏´‡∏¥‡∏ô‡∏≠‡πà‡∏≠‡∏ô','‡∏Ç‡∏±‡∏î‡∏´‡πâ‡∏≠‡∏á‡∏ô‡πâ‡∏≥','‡πÉ‡∏™‡πà‡∏ô‡πâ‡∏≥‡∏ï‡∏≤‡∏•‡∏°‡∏î','‡∏ó‡∏≤‡∏á‡πÄ‡∏î‡∏¥‡∏ô corridor'];
  let tasks = [];
  let currentTab = 'tasks';

  const firebaseConfig = {
    apiKey: "AIzaSyA2szkiP9UyOXR7sGa9ov2lpAsykBQqrX0",
    databaseURL: "https://wellreport-8b077-default-rtdb.firebaseio.com",
    authDomain: "wellreport-8b077.firebaseapp.com",
    projectId: "wellreport-8b077",
    storageBucket: "wellreport-8b077.appspot.com",
    messagingSenderId: "511028766274",
    appId: "1:511028766274:web:9efa70776fcd11e1646fdb"
  };

  const app = firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  // ====== Load & Initialize ======
  function initializeTasks(){
    tasks = [];
    Object.keys(floors).forEach(floor=>{
      floors[floor].forEach(room=>{
        taskTypes.forEach(taskType=>{
          tasks.push({
            id: `${floor}-${room}-${taskType}`,
            floor: floor,
            room: room,
            taskType: taskType,
            assignee: '',
            status: 'pending',
            completedAt: null,
            completedBy: '',
            reviewStatus: 'pending_review',
            reviewedBy: '',
            reviewedAt: null,
            images: []
          });
        });
      });
    });
    db.ref("tasks").set(tasks);
  }

  function loadFromDatabase(){
    const tasksRef = db.ref("tasks");
    tasksRef.on('value', snapshot=>{
      if(snapshot.exists()){
        const data = snapshot.val();
        tasks = Array.isArray(data)? data : Object.values(data);
        renderTasks();
        if(currentTab==='summary') renderSummary();
      } else {
        initializeTasks();
      }
    });
  }

  // ====== Task Functions ======
  function updateAssignee(taskId,value){
    const task = tasks.find(t=>t.id===taskId);
    if(!task) return;
    task.assignee=value;
    db.ref("tasks").set(tasks);
  }

  function updateReviewer(taskId,value){
    const task = tasks.find(t=>t.id===taskId);
    if(!task) return;
    task.reviewedBy=value;
    db.ref("tasks").set(tasks);
  }

  function toggleTaskStatus(taskId){
    const task = tasks.find(t=>t.id===taskId);
    if(!task) return;
    if(task.status==='pending'){
      if(!task.assignee || task.assignee.trim()===''){ alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô‡∏Å‡πà‡∏≠‡∏ô‡∏ó‡∏≥‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏™‡∏£‡πá‡∏à'); return; }
      task.status='completed';
      task.completedAt=new Date().toISOString();
      task.completedBy=task.assignee;
    } else {
      task.status='pending';
      task.completedAt=null;
      task.completedBy='';
    }
    db.ref("tasks").set(tasks);
    renderTasks();
    if(currentTab==='summary') renderSummary();
  }

  function toggleReviewStatus(taskId){
    const task = tasks.find(t=>t.id===taskId);
    if(!task || task.status!=='completed'){ alert('‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏á‡∏≤‡∏ô‡∏ó‡∏µ‡πà‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏™‡∏£‡πá‡∏à‡πÑ‡∏î‡πâ'); return; }
    if(!task.reviewedBy || task.reviewedBy.trim()===''){ alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Å‡πà‡∏≠‡∏ô'); return; }
    task.reviewStatus = task.reviewStatus==='pending_review'? 'reviewed' : 'pending_review';
    task.reviewedAt = task.reviewStatus==='reviewed'? new Date().toISOString() : null;
    db.ref("tasks").set(tasks);
    renderTasks();
    if(currentTab==='summary') renderSummary();
  }

  function uploadFile(file,task){
    if(!task.images) task.images=[];
    const reader = new FileReader();
    reader.onload=e=>{
      task.images.push(e.target.result);
      db.ref("tasks").set(tasks);
      renderTasks();
    }
    reader.readAsDataURL(file);
  }

  function viewImages(id){
    const task = tasks.find(t=>t.id===id);
    if(!task || !(task.images && task.images.length)) return;
    const container = document.getElementById('imageModalContent');
    container.innerHTML = task.images.map(img=>`<img src="${img}" class="w-full mb-2 image-preview">`).join('');
    document.getElementById('imageModal').classList.remove('hidden');
  }

  function closeImageModal(){ document.getElementById('imageModal').classList.add('hidden'); }

  function resetAllTasks(){
    if(!confirm('‡∏Ñ‡∏∏‡∏ì‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ä‡πà‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')) return;
    tasks.forEach(task=>{
      task.status='pending';
      task.completedAt=null;
      task.completedBy='';
      task.assignee='';
      task.images=[];
      task.reviewStatus='pending_review';
      task.reviewedBy='';
      task.reviewedAt=null;
    });
    db.ref("tasks").set(tasks);
    renderTasks();
  }

  function showTab(tab){
    currentTab = tab;
    document.getElementById('tasksTab').className = tab==='tasks'
      ? 'px-6 py-2 bg-blue-500 text-white rounded-lg font-medium hover:bg-blue-600 transition-colors'
      : 'px-6 py-2 bg-gray-200 text-gray-700 rounded-lg font-medium hover:bg-gray-300 transition-colors';
    document.getElementById('summaryTab').className = tab==='summary'
      ? 'px-6 py-2 bg-blue-500 text-white rounded-lg font-medium hover:bg-blue-600 transition-colors'
      : 'px-6 py-2 bg-gray-200 text-gray-700 rounded-lg font-medium hover:bg-gray-300 transition-colors';
    document.getElementById('tasksContent').classList.toggle('hidden', tab!=='tasks');
    document.getElementById('summaryContent').classList.toggle('hidden', tab!=='summary');
    if(tab==='tasks') renderTasks();
    else renderSummary();
  }

  // ====== Render Functions ======
  function renderTasks(){
    const grid = document.getElementById('tasksGrid');
    const floorFilter = document.getElementById('floorFilter').value;
    const roomFilter = document.getElementById('roomFilter').value;
    const statusFilter = document.getElementById('statusFilter').value;

    let filteredTasks = tasks;
    if(floorFilter) filteredTasks = filteredTasks.filter(t => String(t.floor) === floorFilter);
    if(roomFilter) filteredTasks = filteredTasks.filter(t => String(t.room) === roomFilter);
    if(statusFilter) filteredTasks = filteredTasks.filter(t => t.status === statusFilter);

    const groupedTasks={};
    filteredTasks.forEach(task=>{
      const key = `${task.floor}-${task.room}`;
      if(!groupedTasks[key]) groupedTasks[key]=[];
      groupedTasks[key].push(task);
    });

    grid.innerHTML='';
    Object.keys(groupedTasks).forEach(roomKey=>{
      const [floor, room] = roomKey.split('-');
      const roomTasks = groupedTasks[roomKey];
      const completedCount = roomTasks.filter(t=>t.status==='completed').length;
      const totalCount = roomTasks.length;
      const progressPercent = totalCount? (completedCount/totalCount*100):0;

      const roomCard = document.createElement('div');
      roomCard.innerHTML = `
        <div class="bg-gradient-to-r from-blue-500 to-purple-600 text-white p-4">
            <h3 class="text-xl font-bold">üè† ‡∏´‡πâ‡∏≠‡∏á ${room} (‡∏ä‡∏±‡πâ‡∏ô ${floor})</h3>
            <div class="mt-2">
                <div class="flex justify-between text-sm mb-1">
                    <span>‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ñ‡∏∑‡∏ö‡∏´‡∏ô‡πâ‡∏≤</span>
                    <span>${completedCount}/${totalCount} (${Math.round(progressPercent)}%)</span>
                </div>
                <div class="w-full bg-blue-300 rounded-full h-2">
                    <div class="bg-white h-2 rounded-full transition-all duration-500" style="width:${progressPercent}%"></div>
                </div>
            </div>
        </div>
        <div class="p-4">
            <div class="overflow-x-auto">
                <table class="w-full text-sm">
                    <thead>
                        <tr class="border-b">
                            <th class="text-left py-2">‡∏á‡∏≤‡∏ô</th>
                            <th class="text-left py-2">‡∏ú‡∏π‡πâ‡∏ó‡∏≥</th>
                            <th class="text-left py-2">‡∏£‡∏π‡∏õ‡∏†‡∏≤‡∏û</th>
                            <th class="text-left py-2">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏á‡∏≤‡∏ô</th>
                            <th class="text-left py-2">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</th>
                            <th class="text-center py-2">‡∏Å‡∏≤‡∏£‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</th>
                        </tr>
                    </thead>
                    <tbody>
                    ${roomTasks.map(task => `
                        <tr class="border-b hover:bg-gray-50 ${task.status === 'completed' ? 'bg-green-100' : ''}">
                            <td class="py-3 font-medium">${task.taskType}</td>
                            <td class="py-3">
                                <input type="text" value="${task.assignee}" onchange="updateAssignee('${task.id}',this.value)" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡∏ó‡∏≥‡∏á‡∏≤‡∏ô"
                                    ${task.status === 'completed' ? 'disabled' : ''} 
                                    class="w-full px-2 py-1 border rounded text-xs ${task.status === 'completed' ? 'bg-gray-100 cursor-not-allowed' : 'focus:ring-1 focus:ring-blue-500'}">
                            </td>
                            <td class="py-3">
                                <div class="flex items-center space-x-2">
                                    <label class="bg-blue-500 text-white px-2 py-1 rounded text-xs hover:bg-blue-600 cursor-pointer">
                                        üì∑ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏π‡∏õ
                                        <input type="file" id="images-${task.id}" multiple accept="image/*"
                                            onchange="Array.from(this.files).forEach(f=>uploadFile(f,tasks.find(t=>t.id==='${task.id}')))" 
                                            class="sr-only">
                                    </label>
                                    ${task.images.length>0?`<button onclick="viewImages('${task.id}')" class="bg-green-500 text-white px-2 py-1 rounded text-xs hover:bg-green-600">üëÅÔ∏è ‡∏î‡∏π‡∏£‡∏π‡∏õ (${task.images.length})</button>`:''}
                                </div>
                            </td>
                            <td class="py-3">
                                <span class="px-2 py-1 rounded-full text-xs font-medium ${task.status === 'completed'?'bg-green-100 text-green-800':'bg-red-100 text-red-800'}">
                                    ${task.status === 'completed'?'‚úÖ ‡πÄ‡∏™‡∏£‡πá‡∏à‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢':'‚è≥ ‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏™‡∏£‡πá‡∏à'}
                                </span>
                                ${task.completedAt?`<div class="text-xs text-gray-500 mt-1">(${new Date(task.completedAt).toLocaleString()})</div>`:''}
                            </td>
                            <td class="py-3">
                                <span class="px-2 py-1 rounded-full text-xs font-medium ${task.reviewStatus === 'reviewed'?'bg-green-200 text-green-900':'bg-gray-200 text-gray-800'}">
                                    ${task.reviewStatus === 'reviewed'?'‚úîÔ∏è ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡πâ‡∏ß':'‚è≥ ‡∏£‡∏≠‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö'}
                                </span>
                                ${task.reviewedAt?`<div class="text-xs text-gray-500 mt-1">(${new Date(task.reviewedAt).toLocaleString()})</div>`:''}
                            </td>
                            <td class="py-3 text-center space-x-1">
                                <button onclick="toggleTaskStatus('${task.id}')" class="px-2 py-1 text-xs rounded bg-blue-500 text-white hover:bg-blue-600">üìù ‡∏™‡∏•‡∏±‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</button>
                                <button onclick="toggleReviewStatus('${task.id}')" class="px-2 py-1 text-xs rounded bg-purple-500 text-white hover:bg-purple-600">üîç ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</button>
                            </td>
                        </tr>`).join('')}
                    </tbody>
                </table>
            </div>
        </div>
      `;
      roomCard.classList.add('fade-in','rounded-lg','shadow');
      grid.appendChild(roomCard);
    });

    // Update progress bar
    const totalTasks = tasks.length;
    const completedTasks = tasks.filter(t=>t.status==='completed').length;
    const progressPercent = totalTasks? (completedTasks/totalTasks*100) : 0;
    document.getElementById('progressBar').style.width = progressPercent+'%';
    document.getElementById('progressText').textContent = Math.round(progressPercent)+'%';

    // Update floor & room filter dropdowns
    const floorSel = document.getElementById('floorFilter');
    const roomSel = document.getElementById('roomFilter');
    floorSel.innerHTML = '<option value="">‡∏ó‡∏∏‡∏Å‡∏ä‡∏±‡πâ‡∏ô</option>';
    Object.keys(floors).forEach(f=>{ floorSel.innerHTML+=`<option value="${f}">${f}</option>`; });
    if(floorFilter) floorSel.value=floorFilter;

    roomSel.innerHTML='<option value="">‡∏ó‡∏∏‡∏Å‡∏´‡πâ‡∏≠‡∏á</option>';
    if(floorFilter && floors[floorFilter]){
      floors[floorFilter].forEach(r=>roomSel.innerHTML+=`<option value="${r}">${r}</option>`);
    }
    if(roomFilter) roomSel.value=roomFilter;
  }

  function renderSummary(){
    const statsContainer = document.getElementById('summaryStats');
    const tableContainer = document.getElementById('summaryTable');
    const totalTasks = tasks.length;
    const completedTasks = tasks.filter(t=>t.status==='completed').length;
    const pendingTasks = tasks.filter(t=>t.status==='pending').length;
    const reviewedTasks = tasks.filter(t=>t.reviewStatus==='reviewed').length;

    statsContainer.innerHTML = `
      <div class="bg-blue-100 p-4 rounded text-center">
        <div class="text-xl font-bold">${totalTasks}</div>
        <div class="text-sm">‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</div>
      </div>
      <div class="bg-green-100 p-4 rounded text-center">
        <div class="text-xl font-bold">${completedTasks}</div>
        <div class="text-sm">‡πÄ‡∏™‡∏£‡πá‡∏à‡πÅ‡∏•‡πâ‡∏ß</div>
      </div>
      <div class="bg-red-100 p-4 rounded text-center">
        <div class="text-xl font-bold">${pendingTasks}</div>
        <div class="text-sm">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÄ‡∏™‡∏£‡πá‡∏à</div>
      </div>
      <div class="bg-purple-100 p-4 rounded text-center">
        <div class="text-xl font-bold">${reviewedTasks}</div>
        <div class="text-sm">‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÅ‡∏•‡πâ‡∏ß</div>
      </div>
      <div class="bg-yellow-100 p-4 rounded text-center">
        <div class="text-xl font-bold">${totalTasks - completedTasks - pendingTasks}</div>
        <div class="text-sm">‡∏á‡∏≤‡∏ô‡∏≠‡∏∑‡πà‡∏ô</div>
      </div>
    `;

    let tableHTML = `
      <table class="w-full text-sm border">
        <thead class="bg-gray-100">
          <tr>
            <th class="p-2 border">‡∏ä‡∏±‡πâ‡∏ô</th>
            <th class="p-2 border">‡∏´‡πâ‡∏≠‡∏á</th>
            <th class="p-2 border">‡∏á‡∏≤‡∏ô</th>
            <th class="p-2 border">‡∏ú‡∏π‡πâ‡∏ó‡∏≥</th>
            <th class="p-2 border">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th>
            <th class="p-2 border">‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡πÇ‡∏î‡∏¢</th>
            <th class="p-2 border">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö</th>
          </tr>
        </thead>
        <tbody>
          ${tasks.map(t=>`
            <tr class="${t.status==='completed'?'bg-green-50':''}">
              <td class="p-2 border">${t.floor}</td>
              <td class="p-2 border">${t.room}</td>
              <td class="p-2 border">${t.taskType}</td>
              <td class="p-2 border">${t.assignee || '-'}</td>
              <td class="p-2 border">${t.status==='completed'?'‚úÖ':'‚è≥'}</td>
              <td class="p-2 border">${t.reviewedBy || '-'}</td>
              <td class="p-2 border">${t.reviewStatus==='reviewed'?'‚úîÔ∏è':'‚è≥'}</td>
            </tr>
          `).join('')}
        </tbody>
      </table>
    `;
    tableContainer.innerHTML=tableHTML;
  }

  // ====== Init ======
  window.onload = () => {
    showTab('tasks');
    loadFromDatabase();
  }

  document.getElementById('floorFilter').addEventListener('change',renderTasks);
  document.getElementById('roomFilter').addEventListener('change',renderTasks);
  document.getElementById('statusFilter').addEventListener('change',renderTasks);

</script>
</body>
</html>
